<!DOCTYPE html>
<html>
    <head>
        <title>ORIGAM Documentation : How to set up an event logging with Log Transformations</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">ORIGAM Documentation</a></span>
                            </li>
                                                    <li>
                                <span><a href="ORIGAM-Enterprise-Home_589829.html">ORIGAM Enterprise Home</a></span>
                            </li>
                                                    <li>
                                <span><a href="How-to-articles_7831641.html">How-to articles</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            ORIGAM Documentation : How to set up an event logging with Log Transformations
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
    
        
    
        
        
            Created by <span class='author'> V치clav Urb치nek</span>, last modified by <span class='editor'> Tom치코 Vavrda</span> on Jun 12, 2015
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <h1 id="HowtosetupaneventloggingwithLogTransformations-PurposeofLogTransformations">Purpose of Log Transformations</h1><p>Setup a logging of events is crucial, when you need to analyse some events in your application.</p><p>Log Transformations is an effective tool to easily setup logging of events.</p><p>An example of event could be e.g. adding an item to a shopping cart in your e-shop application.</p><p>An example of analytics you could be interested in:</p><ul><li>count for day</li><li>count for product and day</li><li>count for geo-region and day</li></ul><h1 id="HowtosetupaneventloggingwithLogTransformations-ScenariosofLogTransformationsuse">Scenarios of Log Transformations use</h1><p>Log Transformations could be set in API data pages.</p><p>So they are applicable for standard or javascript web application.</p><ul><li>Standard web application based on HTML is generated using API data pages.</li><li>Javascript-based web appliaction using API data pages as backend.</li><li>Special events (e.g. deletion of a shopping cart) possibly doesn't correspond to any existing data page. It can be logged by special API data page created only for logging purpose and to be called by javascript from web application.</li></ul><p>Currently, it is not possible to apply Log Transfromations on workflow data pages.</p><h1 id="HowtosetupaneventloggingwithLogTransformations-1.LoggingSetup">1. Logging Setup</h1><p>First we need to decide, which API page and its data we want to log. We need to choose one from API at model browser.</p><p>This paricular one gets the data of all timesheets of selected project (from ORIGAM demo application)</p><p><span class="confluence-embedded-file-wrapper">#TODO_FILE:6258727#</span></p><h1 id="HowtosetupaneventloggingwithLogTransformations-2.CreateLogtransformation">2. Create Log transformation</h1><p>Log transformation takes a data of Data Structure (ProjectWithTimesheet) and transforms it to the data, that are expected by logger.</p><p>In transformation we can specify, which data from the structure we want to log.</p><p>Create new transformation in your application:</p><p><span class="confluence-embedded-file-wrapper">#TODO_FILE:6258729#</span></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>An example of xslt transformation</b></div><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: xml; gutter: true; theme: Confluence" data-theme="Confluence"> &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;xsl:stylesheet xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot; version=&quot;1.0&quot;
    xmlns:AS=&quot;http://schema.advantages.cz/AsapFunctions&quot;
    xmlns:date=&quot;http://exslt.org/dates-and-times&quot; exclude-result-prefixes=&quot;AS date&quot;&gt;
    
    &lt;xsl:template match=&quot;ROOT&quot;&gt;
        &lt;ROOT&gt;
            &lt;!-- Add arbitrary infromation
                 - e.g. Name and Surname of currently logged user --&gt;
            &lt;!-- copy whole content into one field as a xml --&gt;
            &lt;LogContext                
                UserBusinessPartnerInfo=&quot;{AS:LookupValue(
                        &#39;08d82ef5-df38-48d6-a276-ee5b7f027bd6&#39;,
                        AS:ActiveProfileId())}&quot;
                VarData=&quot;{AS:NodeToString(.)}&quot; &gt;LOG_ALL
            &lt;/LogContext&gt;
        &lt;/ROOT&gt;
    &lt;/xsl:template&gt;
&lt;/xsl:stylesheet&gt;</pre>
</div></div><p>Data logger expects xml element <em>LogContent</em> which is supplied. All attributes of <em>LogContent</em> with arbitraty names will be accessible at logger.</p><p>In our example we send to <em>LogContent</em> 2 attrributes :</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">Attribute name</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd">UserBusinessPartnerInfo</td><td class="confluenceTd"><span class="confluence-link"> </span>Name and surname of currently logged user (make use of <a href="LookupValue_5668887.html">LookupValue</a>)</td></tr><tr><td class="confluenceTd">VarData</td><td class="confluenceTd">Contains all data of input XML data structure (ProjectWithTimesheets) serialized as a string (make use of AS:NodeToString() function)</td></tr></tbody></table></div><p>This approach with 'VarData' logs all the data without any modification.</p><p>This approach has an advantage of storing everything (because sometimes the historic data are no more available). Moreover, this paricular transformation is generic and can be used to any API data page.</p><p>The disadvantage could be the volume of logged data.</p><h1 id="HowtosetupaneventloggingwithLogTransformations-3.Configure&quot;Analytics&quot;logger">3. Configure &quot;Analytics&quot; logger</h1><p>Firstly we have to create a log4net logger and add an appender.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Add appender to Log4Net config section</b></div><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: xml; gutter: false; theme: Confluence" data-theme="Confluence">&lt;log4net&gt;
... 
	&lt;logger name=&quot;Analytics&quot;&gt;
		&lt;level value=&quot;INFO&quot; /&gt;
	    &lt;appender-ref ref=&quot;DetailedAnalyticsAppender&quot; /&gt;
		&lt;!-- ... more analytics appenders here --&gt;
  	&lt;/logger&gt;
...
&lt;/log4net&gt;</pre>
</div></div><h1 id="HowtosetupaneventloggingwithLogTransformations-4A.Setupdatabaseappender">4A. Setup database appender</h1><p>Now we have to configure an appender. The example expected, that a database table <em>Log</em> exists with columns <em>VarData</em>, <em>PageId</em> and <em>User</em>.</p><p>The logging table needn't to be in main application database. It can be placed even at another database engine.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Setup a database appender</b></div><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">      &lt;appender name=&quot;DetailedAnalyticsAppender&quot; type=&quot;log4net.Appender.AdoNetAppender&quot;&gt;
          &lt;filter type=&quot;log4net.Filter.StringMatchFilter&quot;&gt;
              &lt;stringToMatch value=&quot;LOG_ALL&quot; /&gt;
          &lt;/filter&gt;
          &lt;filter type=&quot;log4net.Filter.DenyAllFilter&quot; /&gt;
          &lt;threshold value=&quot;ALL&quot; /&gt;
          &lt;bufferSize value=&quot;1&quot; /&gt;
          &lt;connectionType value=&quot;System.Data.SqlClient.SqlConnection, System.Data, Version=1.0.3300.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&quot; /&gt;
          &lt;connectionString value=&quot;Data Source=&lt;sql server instance name&gt;;Initial Catalog=&lt;db name&gt;;User ID=&lt;username&gt;;Password=&lt;passwd&gt;&quot; /&gt;
          &lt;commandText value=&quot;INSERT INTO [dbo].[Log] ([VarData],[PageId],[User]) VALUES
            ( @VarData,
              CASE WHEN @PageId = &#39;(null)&#39; THEN NULL ELSE @PageId END),
            , @User)&quot; /&gt;
          &lt;parameter&gt;
              &lt;parameterName value=&quot;@VarData&quot; /&gt;
              &lt;dbType value=&quot;string&quot; /&gt;
                &lt;size value=&quot;-1&quot; /&gt;
                &lt;layout type=&quot;log4net.Layout.PatternLayout&quot;&gt;
                  &lt;conversionPattern value=&quot;%property{VarData}&quot; /&gt;
              &lt;/layout&gt;
          &lt;/parameter&gt;
          &lt;parameter&gt;
              &lt;parameterName value=&quot;@User&quot; /&gt;
              &lt;dbType value=&quot;String&quot; /&gt;
              &lt;size value=&quot;50&quot; /&gt;
              &lt;layout type=&quot;log4net.Layout.PatternLayout&quot;&gt;
                  &lt;conversionPattern value=&quot;%property{UserBusinessPartnerInfo}&quot; /&gt;
              &lt;/layout&gt;
          &lt;/parameter&gt;
          &lt;parameter&gt;
              &lt;parameterName value=&quot;@PageId&quot; /&gt;
              &lt;dbType value=&quot;String&quot; /&gt;
              &lt;size value=&quot;40&quot; /&gt;
              &lt;layout type=&quot;log4net.Layout.PatternLayout&quot;&gt;
                  &lt;conversionPattern value=&quot;%property{AsapPageId}&quot; /&gt;
              &lt;/layout&gt;
          &lt;/parameter&gt;
      &lt;/appender&gt;</pre>
</div></div><p><em>Parameter</em> elements map attributes from <em>LogContext</em> into Log4Net parameters, that can be used in <em>commandText</em> insert statement.</p><p>The following element specify for which context store the appender will apply.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">&lt;stringToMatch value=&quot;LOG_ALL&quot; /&gt;</pre>
</div></div><p>Besides the attributes that we have passed in log transformation, LogContent containts more build-in automatically generated attributes. To log only some of those paameters and nothing more, we wouldn't need a log transformation at all.</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">Attribute name</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd">Parameter_&lt;parameter name&gt;</td><td class="confluenceTd"><p>Each data page url parameter is automatically added to log context and prepended with &quot;Parameter_&quot; prefix.</p></td></tr><tr><td class="confluenceTd">ContentType</td><td class="confluenceTd">Mime type of the API data page content type.</td></tr><tr><td class="confluenceTd">HttpMethod</td><td class="confluenceTd">GET/POST/PUT/...</td></tr><tr><td class="confluenceTd">RawUrl</td><td class="confluenceTd"><p>Request url.(raw form)</p></td></tr><tr><td colspan="1" class="confluenceTd">Url</td><td colspan="1" class="confluenceTd">Request url</td></tr><tr><td colspan="1" class="confluenceTd">UrlReferrer</td><td colspan="1" class="confluenceTd">Value of url referrer sent in request http header.</td></tr><tr><td colspan="1" class="confluenceTd">UserAgent</td><td colspan="1" class="confluenceTd">Value of UserAgent sent in request http header.</td></tr><tr><td colspan="1" class="confluenceTd">Browser</td><td colspan="1" class="confluenceTd">Browser name parsed from UserAgent.</td></tr><tr><td colspan="1" class="confluenceTd">BrowserVersion</td><td colspan="1" class="confluenceTd">Browser version parsed from UserAgent.</td></tr><tr><td colspan="1" class="confluenceTd">UserHostAddress</td><td colspan="1" class="confluenceTd">Client IP address.</td></tr><tr><td colspan="1" class="confluenceTd">UserHostName</td><td colspan="1" class="confluenceTd">Domain name resolved from IP address.</td></tr><tr><td colspan="1" class="confluenceTd">UserLanuages</td><td colspan="1" class="confluenceTd">???</td></tr></tbody></table></div><h1 id="HowtosetupaneventloggingwithLogTransformations-4B.Setupfileappender">4B. Setup file appender</h1><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>File appender configuration</b></div><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">      &lt;appender name=&quot;DetailedAnalyticsAppender&quot; type=&quot;log4net.Appender.RollingFileAppender&quot;&gt;
          &lt;file value=&quot;&lt;path-to-log&gt;&quot; /&gt;
          &lt;appendToFile value=&quot;true&quot; /&gt;
          &lt;rollingStyle value=&quot;Date&quot; /&gt;
          &lt;datePattern value=&quot;yyyyMMdd&quot; /&gt;
          &lt;filter type=&quot;log4net.Filter.StringMatchFilter&quot;&gt;
              &lt;stringToMatch value=&quot;LOG_ALL&quot; /&gt;
          &lt;/filter&gt;          
          &lt;filter type=&quot;log4net.Filter.DenyAllFilter&quot; /&gt;
          &lt;threshold value=&quot;ALL&quot; /&gt;
          &lt;bufferSize value=&quot;1&quot; /&gt;
          
          &lt;layout type=&quot;log4net.Layout.PatternLayout&quot;&gt;
            &lt;conversionPattern value=&quot;&#39;%date&#39;,&#39;%property{AsapPageId}&#39;,&#39;%property{UserBusinessPartnerInfo}&#39;,&#39;%property{VarData}&#39;%newline&quot; /&gt;
          &lt;/layout&gt;
      &lt;/appender&gt;</pre>
</div></div><p> </p><p> </p>
                    </div>

                                                            </div></div><div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Jun 29, 2022 20:33</p>
                    <div id="footer-logo"><a href="https://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
