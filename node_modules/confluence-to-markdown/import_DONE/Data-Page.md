# Data Page

Data page can be used to expose [CRUD](http://en.wikipedia.org/wiki/Create,_read,_update_and_delete) data operations.Using a Data Page you can

-   Expose data in different formats (XML, JSON, HTML, CSV...) using `GET` and `POST` requests
-   Insert or update records using `PUT` requests
-   Delete records using `DELETE` requests

# Attributes

<table class="confluenceTable">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<th class="confluenceTh">DataStructure</th>
<td class="confluenceTd">Data Structure the data will be based on.</td>
</tr>
<tr class="even">
<th class="confluenceTh">Method</th>
<td class="confluenceTd">Optional method (filter) to be used for getting the data.</td>
</tr>
<tr class="odd">
<th class="confluenceTh">SortSet</th>
<td class="confluenceTd">Optional sort set using which the data will be sorted.</td>
</tr>
<tr class="even">
<th class="confluenceTh">Transformation</th>
<td class="confluenceTd"><p>Optional XSLT Transformation that will be used to transform the data returned by the data service using the DataStructure attribute.</p>
<p>If Transformation is omitted the result is the raw data as returned by the data service in a format depending on a specified MimeType:</p>
<ul>
<li><code>application/xml -</code> will produce an XML document</li>
<li><code>application/json -</code> will produce a JSON document</li>
</ul>
<p>If you want to provide data in another format you need to use the transformation to produce data in such a format. The above specified formats can be used without a transformation and data will be converted automatically.</p>
<p>When <strong>MimeType</strong> is application/json, please consider to define also <strong>TransformationOutputStructure</strong>.</p></td>
</tr>
<tr class="odd">
<th class="confluenceTh">TransformationOutputStructure</th>
<td class="confluenceTd">A data structure where an output of the <strong>Transformation</strong> will be merged into. It's applied only when <strong>ResultXpath</strong> is not set and a <strong>MimeType</strong> field is set to application/json.If not defined, the final XML-&gt;JSON conversion after transformation works the following way: DataTypes - float, int, boolen, etc. are converted to string, attributes are prefixed with @. But if defined, conversion is DataSet-&gt;JSON conversion, which performs the standard way (as without transformation).</td>
</tr>
<tr class="even">
<th class="confluenceTh">ResultXPath</th>
<td class="confluenceTd"><p>In case you need a single value or only a subset of the produced data you can use an XPath expression to select only the data you need to return.</p>
<p>A string value of the resulting Xpath navigator ia used. It's mainly used for extracting pure text out of the result xml. If it's set and application/json mime-type is set too, then resulting JSON conversion is always done as a non-typed XML-&gt;JSON conversion (regardless of how Transformation and TransformationOutputStructure are set).</p></td>
</tr>
<tr class="odd">
<th class="confluenceTh">AllowPUT</th>
<td class="confluenceTd">If set to <strong>True</strong> it will be possible to use a <code>PUT</code> HTTP request to send data back to the API to be saved to the database.</td>
</tr>
<tr class="even">
<th class="confluenceTh">AllowDELETE</th>
<td class="confluenceTd">If set to True it will be possible to use a DELETE HTTP request to send data back to the API to be deleted from the database.</td>
</tr>
<tr class="odd">
<th class="confluenceTh">SaveValidationBeforeMerge</th>
<td class="confluenceTd"><p>A validation rule that will be called on the data loaded from the database before the data from input is merged into.</p></td>
</tr>
<tr class="even">
<th class="confluenceTh">SaveValidationAfterMerge</th>
<td class="confluenceTd"><p>A validation rule that will be called after merging the data from a database with a data from input. This can be used for validating the resulting (updated) data before saving them in a database.</p>
<div>
<div>
<p>You will probably have the same validation rule set up as a state event anyway so any data access is always validated but you can assign the same rule here because it is cheaper to stop the web request if it is invalid than locking data in the database and validating them later in the process.</p>
</div>
</div></td>
</tr>
<tr class="odd">
<th class="confluenceTh">LogTransformation</th>
<td class="confluenceTd">An XSLT transformation that will produce enhanced logging data. For details see <a href="/t/How-to-set-up-an-event-logging-with-Log-Transformations">How to set up an event logging with Log Transformations</a>.</td>
</tr>
<tr class="even">
<th class="confluenceTh">OmitJsonRootElement</th>
<td class="confluenceTd"><p>If set to <strong>True</strong> and the MimeType is JSON the returned JSON string will not contain the root element converted from the XML representation (e.g. "ROOT").</p>
<p>It's applied only if a non-typed XML-&gt;JSON conversion is used (Transformation is given while TransformationOutputDatastructure is not)</p></td>
</tr>
</tbody>
</table>

# Updating And Inserting Data

When you want to send JSON or XML data back to the API in the HTTP request body you need to:

1.  Set **AllowPUT** to `True`.
2.  Add a new ParameterMapping under the Data Page API with any name and MappedParameter empty. This will pass the body to the API.
3.  Send the request under the same URL you used to load the data, e.g. /api/invoice/1234

It is recommended to set **AllFields=True** in the source data structure entities otherwise concurrency exceptions can occur.

The process then goes like this:

1.  When you send PUT request to `/api/invoice/1234` first the old invoice no. 1234 is loaded from the database
2.  Then the data of the old invoice are updated with the data sent with the request
3.  Then the changes are saved to the database.

If you want to insert data you basically need to provide a parameter under which no invoice will be loaded, e.g.` /api/invoice/new`. The first step which loads the record will find nothing resulting in INSERTs into the database.

Server has to be set to run all managed modules for all request, otherwise put operation will fail because of unauthorized access.

`<modules runAllManagedModulseForAllRequest="true">`

`</modules>`

# Pagination

You can use built-in data pagination functions to return pages of data instead of whole lists. See [LoadData Method](/t/LoadData-Method) for details.

You need to map the input parameters to the internal `_pageNumber` and `_pageSize` parameters the same way you would map other parameters. See Kendo Mobile - Pagination And Server Side Filtering for an example.

# Deleting Data

When you wan to send a request that will delete data you need to:

1.  Set AllowDELETE to True
2.  Send a request to the URL, e.g. `/api/invoice/1234`
3.  The data will get loaded and then deleted.

# Concurrency Handling

As you see from the previous example there is no concurrency handling built-in and the last write wins.
