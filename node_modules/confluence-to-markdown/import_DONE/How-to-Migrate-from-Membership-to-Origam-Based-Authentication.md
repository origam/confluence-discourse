# How to Migrate from Membership to Origam Based Authentication

This article describes mapping from `AspNetMembership` tables to `OrigamUser` table.

<table class="confluenceTable">
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<tbody>
<tr class="header">
<th class="confluenceTh">OrigamUser Column</th>
<th class="confluenceTh">DataType</th>
<th class="confluenceTh">Allow Nulls</th>
<th class="confluenceTh">AspNetMembership Column</th>
<th class="confluenceTh">Note</th>
</tr>

<tr class="odd">
<td class="confluenceTd">refBusinessPartnerId</td>
<td class="confluenceTd">uniqueidentifier</td>
<td class="confluenceTd">no</td>
<td class="confluenceTd"></td>
<td class="confluenceTd">Value has to be looked for in Origam BusinessPartner table. It should be searched by UserName.</td>
</tr>
<tr class="even">
<td class="confluenceTd">Password</td>
<td class="confluenceTd">nvarchar(100)</td>
<td class="confluenceTd">yes</td>
<td class="confluenceTd"><p>aspnet_Membership.Password</p>
<p>aspnet_Membership.Salt</p></td>
<td class="confluenceTd"><p>Values from Password and Salt column need to be combined into one string with | as separation character: password|salt.</p></td>
</tr>
<tr class="odd">
<td class="confluenceTd">RecordCreatedBy</td>
<td class="confluenceTd">uniqueidentifier</td>
<td class="confluenceTd">yes</td>
<td class="confluenceTd"></td>
<td class="confluenceTd"></td>
</tr>
<tr class="even">
<td class="confluenceTd">RecordUpdatedBy</td>
<td class="confluenceTd">uniqueidentifier</td>
<td class="confluenceTd">yes</td>
<td class="confluenceTd"></td>
<td class="confluenceTd"></td>
</tr>
<tr class="odd">
<td class="confluenceTd">Id</td>
<td class="confluenceTd">uniqueidentifier</td>
<td class="confluenceTd">no</td>
<td class="confluenceTd"></td>
<td class="confluenceTd">Primary key.</td>
</tr>
<tr class="even">
<td class="confluenceTd">RecordCreated</td>
<td class="confluenceTd">datetime</td>
<td class="confluenceTd">yes</td>
<td class="confluenceTd">aspnet_Membership.CreateDate</td>
<td class="confluenceTd"></td>
</tr>
<tr class="odd">
<td class="confluenceTd">RecordUpdated</td>
<td class="confluenceTd">datetime</td>
<td class="confluenceTd">yes</td>
<td class="confluenceTd"></td>
<td class="confluenceTd"></td>
</tr>
<tr class="even">
<td class="confluenceTd">IsLockedOut</td>
<td class="confluenceTd">bit</td>
<td class="confluenceTd">no</td>
<td class="confluenceTd">aspnet_Membership.IsLockedOut</td>
<td class="confluenceTd"></td>
</tr>
<tr class="odd">
<td class="confluenceTd">LastLoginDate</td>
<td class="confluenceTd">datetime</td>
<td class="confluenceTd">yes</td>
<td class="confluenceTd">aspnet_Membership.LastLoginDate</td>
<td class="confluenceTd"></td>
</tr>
<tr class="even">
<td class="confluenceTd">LastLockoutDate</td>
<td class="confluenceTd">datetime</td>
<td class="confluenceTd">yes</td>
<td class="confluenceTd">aspnet_Membership.LastLockoutDate</td>
<td class="confluenceTd"></td>
</tr>
<tr class="odd">
<td class="confluenceTd">FailedPasswordAttemptCount</td>
<td class="confluenceTd">int</td>
<td class="confluenceTd">no</td>
<td class="confluenceTd">aspnet_Membership.FailedPasswordAttemptCount</td>
<td class="confluenceTd"></td>
</tr>
<tr class="even">
<td class="confluenceTd">FailedPasswordAttemptWindowStart</td>
<td class="confluenceTd">datetime</td>
<td class="confluenceTd">yes</td>
<td class="confluenceTd">aspnet_Membership.FailedPasswordAttemptWindowStart</td>
<td class="confluenceTd"></td>
</tr>
<tr class="odd">
<td class="confluenceTd">UserName</td>
<td class="confluenceTd">nvarchar(255)</td>
<td class="confluenceTd">yes</td>
<td class="confluenceTd">aspnet_Users.UserName</td>
<td class="confluenceTd"></td>
</tr>
<tr class="even">
<td class="confluenceTd">EmailConfirmed</td>
<td class="confluenceTd">bit</td>
<td class="confluenceTd">no</td>
<td class="confluenceTd">aspnet_Membership.IsApproved</td>
<td class="confluenceTd"></td>
</tr>
</tbody>
</table>

The following sql script could be used to migrate users from aspnet membership database to ORIGAM user database. The script expects to be run connected to your ORIGAM data database and AspNetMembership database to be named as 'aspnetdb'. There could be a problems with different collations of the two databases. In the following example script it's solved by added COLLATE expressions. However if the collation of your databases (ORIGAM data and AspNetMembership) are the same, then all the COLLATE expressions should be ommitted.

**Sql Script for migration of users**

``` sql
INSERT INTO OrigamUser
(
    refBusinessPartnerId
    , Password
    , RecordCreated
    , RecordUpdated
    , Id
    , IsLockedOut
    , LastLoginDate
    , LastLockoutDate
    , FailedPasswordAttemptCount
    , FailedPasswordAttemptWindowStart
    , UserName
    , EmailConfirmed
)
SELECT
    (SELECT Id From BusinessPartner bp WHERE bp.UserName = au.UserName COLLATE Czech_CI_AS)
    , CONCAT(am.Password COLLATE Czech_CI_AS, '|' COLLATE Czech_CI_AS, am.PasswordSalt COLLATE Czech_CI_AS)
    , am.CreateDate
    , NULL
    , NEWID()
    , am.IsLockedOut
    , am.LastLoginDate
    , am.LastLockoutDate
    , am.FailedPasswordAttemptCount
    , am.FailedPasswordAnswerAttemptWindowStart
    , au.UserName
    , am.IsApproved
FROM
    aspnetdb.dbo.vw_aspnet_Users au
    INNER JOIN aspnetdb.dbo.aspnet_Membership am ON am.UserId = au.UserId
WHERE
    (SELECT Id From BusinessPartner bp WHERE bp.UserName = au.UserName COLLATE Czech_CI_AS) is not null
```
