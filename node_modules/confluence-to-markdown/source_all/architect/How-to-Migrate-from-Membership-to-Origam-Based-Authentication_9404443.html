<!DOCTYPE html>
<html>
    <head>
        <title>ORIGAM Documentation : How to Migrate from Membership to Origam Based Authentication</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">ORIGAM Documentation</a></span>
                            </li>
                                                    <li>
                                <span><a href="ORIGAM-Enterprise-Home_589829.html">ORIGAM Enterprise Home</a></span>
                            </li>
                                                    <li>
                                <span><a href="How-to-articles_7831641.html">How-to articles</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            ORIGAM Documentation : How to Migrate from Membership to Origam Based Authentication
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
    
        
    
        
        
            Created by <span class='author'> Petr Hrehorovský</span>, last modified by <span class='editor'> Václav Urbánek</span> on Apr 02, 2015
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <p>This article describes mapping from <code>AspNetMembership</code> tables to <code>OrigamUser</code> table.</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">OrigamUser Column</th><th class="confluenceTh">DataType</th><th colspan="1" class="confluenceTh">Allow Nulls</th><th class="confluenceTh">AspNetMembership Column</th><th class="confluenceTh">Note</th></tr><tr><td class="confluenceTd">refBusinessPartnerId</td><td class="confluenceTd">uniqueidentifier</td><td colspan="1" class="confluenceTd">no</td><td class="confluenceTd"> </td><td class="confluenceTd">Value has to be looked for in Origam BusinessPartner table. It should be searched by UserName.</td></tr><tr><td class="confluenceTd">Password</td><td class="confluenceTd">nvarchar(100)</td><td colspan="1" class="confluenceTd">yes</td><td class="confluenceTd"><p>aspnet_Membership.Password</p><p>aspnet_Membership.Salt</p></td><td class="confluenceTd"><p>Values from Password and Salt column need to be combined into one string with | as separation character: password|salt.</p></td></tr><tr><td colspan="1" class="confluenceTd">RecordCreatedBy</td><td colspan="1" class="confluenceTd">uniqueidentifier</td><td colspan="1" class="confluenceTd">yes</td><td colspan="1" class="confluenceTd"> </td><td colspan="1" class="confluenceTd"> </td></tr><tr><td colspan="1" class="confluenceTd">RecordUpdatedBy</td><td colspan="1" class="confluenceTd">uniqueidentifier</td><td colspan="1" class="confluenceTd">yes</td><td colspan="1" class="confluenceTd"> </td><td colspan="1" class="confluenceTd"> </td></tr><tr><td colspan="1" class="confluenceTd">Id</td><td colspan="1" class="confluenceTd">uniqueidentifier</td><td colspan="1" class="confluenceTd">no</td><td colspan="1" class="confluenceTd"> </td><td colspan="1" class="confluenceTd">Primary key.</td></tr><tr><td colspan="1" class="confluenceTd">RecordCreated</td><td colspan="1" class="confluenceTd">datetime</td><td colspan="1" class="confluenceTd">yes</td><td colspan="1" class="confluenceTd">aspnet_Membership.CreateDate</td><td colspan="1" class="confluenceTd"> </td></tr><tr><td colspan="1" class="confluenceTd">RecordUpdated</td><td colspan="1" class="confluenceTd">datetime</td><td colspan="1" class="confluenceTd">yes</td><td colspan="1" class="confluenceTd"> </td><td colspan="1" class="confluenceTd"> </td></tr><tr><td colspan="1" class="confluenceTd">IsLockedOut</td><td colspan="1" class="confluenceTd">bit</td><td colspan="1" class="confluenceTd">no</td><td colspan="1" class="confluenceTd">aspnet_Membership.IsLockedOut</td><td colspan="1" class="confluenceTd"> </td></tr><tr><td colspan="1" class="confluenceTd">LastLoginDate</td><td colspan="1" class="confluenceTd">datetime</td><td colspan="1" class="confluenceTd">yes</td><td colspan="1" class="confluenceTd">aspnet_Membership.LastLoginDate</td><td colspan="1" class="confluenceTd"> </td></tr><tr><td colspan="1" class="confluenceTd">LastLockoutDate</td><td colspan="1" class="confluenceTd">datetime</td><td colspan="1" class="confluenceTd">yes</td><td colspan="1" class="confluenceTd">aspnet_Membership.LastLockoutDate</td><td colspan="1" class="confluenceTd"> </td></tr><tr><td colspan="1" class="confluenceTd">FailedPasswordAttemptCount</td><td colspan="1" class="confluenceTd">int</td><td colspan="1" class="confluenceTd">no</td><td colspan="1" class="confluenceTd">aspnet_Membership.FailedPasswordAttemptCount</td><td colspan="1" class="confluenceTd"> </td></tr><tr><td colspan="1" class="confluenceTd">FailedPasswordAttemptWindowStart</td><td colspan="1" class="confluenceTd">datetime</td><td colspan="1" class="confluenceTd">yes</td><td colspan="1" class="confluenceTd">aspnet_Membership.FailedPasswordAttemptWindowStart</td><td colspan="1" class="confluenceTd"> </td></tr><tr><td colspan="1" class="confluenceTd">UserName</td><td colspan="1" class="confluenceTd">nvarchar(255)</td><td colspan="1" class="confluenceTd">yes</td><td colspan="1" class="confluenceTd">aspnet_Users.UserName</td><td colspan="1" class="confluenceTd"> </td></tr><tr><td colspan="1" class="confluenceTd">EmailConfirmed</td><td colspan="1" class="confluenceTd">bit</td><td colspan="1" class="confluenceTd">no</td><td colspan="1" class="confluenceTd">aspnet_Membership.IsApproved</td><td colspan="1" class="confluenceTd"> </td></tr></tbody></table></div><p> </p><p>The following sql script could be used to migrate users from aspnet membership database to ORIGAM user database. The script expects to be run connected to your ORIGAM data database and AspNetMembership database to be named as 'aspnetdb'. There could be a problems with different collations of the two databases. In the following example script it's solved by added COLLATE expressions. However if the collation of your databases (ORIGAM data and AspNetMembership) are the same, then all the COLLATE expressions should be ommitted.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Sql Script for migration of users</b></div><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: sql; gutter: true; theme: Confluence" data-theme="Confluence">INSERT INTO OrigamUser
(
    refBusinessPartnerId
    , Password
    , RecordCreated
    , RecordUpdated
    , Id
    , IsLockedOut
    , LastLoginDate
    , LastLockoutDate
    , FailedPasswordAttemptCount
    , FailedPasswordAttemptWindowStart
    , UserName
    , EmailConfirmed
)
SELECT
    (SELECT Id From BusinessPartner bp WHERE bp.UserName = au.UserName COLLATE Czech_CI_AS)
    , CONCAT(am.Password COLLATE Czech_CI_AS, &#39;|&#39; COLLATE Czech_CI_AS, am.PasswordSalt COLLATE Czech_CI_AS)
    , am.CreateDate
    , NULL
    , NEWID()
    , am.IsLockedOut
    , am.LastLoginDate
    , am.LastLockoutDate
    , am.FailedPasswordAttemptCount
    , am.FailedPasswordAnswerAttemptWindowStart
    , au.UserName
    , am.IsApproved
FROM
    aspnetdb.dbo.vw_aspnet_Users au
    INNER JOIN aspnetdb.dbo.aspnet_Membership am ON am.UserId = au.UserId
WHERE
    (SELECT Id From BusinessPartner bp WHERE bp.UserName = au.UserName COLLATE Czech_CI_AS) is not null</pre>
</div></div>
                    </div>

                                        
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Jun 29, 2022 20:33</p>
                    <div id="footer-logo"><a href="https://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
