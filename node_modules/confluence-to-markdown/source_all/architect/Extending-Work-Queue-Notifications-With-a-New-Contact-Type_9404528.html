<!DOCTYPE html>
<html>
    <head>
        <title>ORIGAM Documentation : Extending Work Queue Notifications With a New Contact Type</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">ORIGAM Documentation</a></span>
                            </li>
                                                    <li>
                                <span><a href="ORIGAM-Enterprise-Home_589829.html">ORIGAM Enterprise Home</a></span>
                            </li>
                                                    <li>
                                <span><a href="ORIGAM-Architect_8716616.html">ORIGAM Architect</a></span>
                            </li>
                                                    <li>
                                <span><a href="Model-Reference_4620401.html">Model Reference</a></span>
                            </li>
                                                    <li>
                                <span><a href="Business-Logic-Model_1736812.html">Business Logic Model</a></span>
                            </li>
                                                    <li>
                                <span><a href="Work-Queue-Classes_4620319.html">Work Queue Classes</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            ORIGAM Documentation : Extending Work Queue Notifications With a New Contact Type
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
    
        
    
        
        
            Created by <span class='author'> Václav Urbánek</span>, last modified by <span class='editor'> Tomáš Vavrda</span> on Nov 19, 2015
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <p>It comes handy when you want to send notifications to recipients that are to be computed dynamically based on the data. E.g. send a notification to all staff of order's business unit.</p><p>Can be also used to generate senders as well.</p><h1 id="ExtendingWorkQueueNotificationsWithaNewContactType-Step-by-stepguide">Step-by-step guide</h1><ol><li>Insert a new notification contact type into a database<br/>In our example we are going to extract a customer email from a booking (rental transaction). So this type of contact can be used in many notifications which involves that booking – e.g. various state changes (new, reservation expired, has been closed, etc.)<br/><br/><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" draggable="false" src="attachments/9404528/9404527.png" data-image-src="attachments/9404528/9404527.png" data-unresolved-comment-count="0" data-linked-resource-id="9404527" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image2015-4-23 12:44:22.png" data-base-url="https://confluence.origam.com" data-linked-resource-content-type="image/png" data-linked-resource-container-id="9404528" data-linked-resource-container-version="10" alt=""></span><p>If you have a multi-lingual application, you can also add translations of the newly created contact type by inserting the records into <code>WorkQueueNotificationContactType_l10n</code> table.</p></li><li>Extend <code>GetNotificationContacts</code> Workflow to handle out new contact type<br/>The workflow is called from within WorkQueue notification subsystem.<br/><br/><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" draggable="false" height="400" src="attachments/9404528/9404531.png" data-image-src="attachments/9404528/9404531.png" data-unresolved-comment-count="0" data-linked-resource-id="9404531" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image2015-4-23 14:28:44.png" data-base-url="https://confluence.origam.com" data-linked-resource-content-type="image/png" data-linked-resource-container-id="9404528" data-linked-resource-container-version="10" alt=""></span><br/><br/>The picture shows the target state of workflow. So that's it. The next steps will describe how to achive this result.</li><li>Create a new data constant with an <strong>Id</strong> of your new notification data type<br/><strong>Data &gt; Constants &gt; YouPackageName &gt; New &gt; Data Constant</strong><br/><br/><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" draggable="false" src="attachments/9404528/9404533.png" data-image-src="attachments/9404528/9404533.png" data-unresolved-comment-count="0" data-linked-resource-id="9404533" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image2015-4-23 14:42:22.png" data-base-url="https://confluence.origam.com" data-linked-resource-content-type="image/png" data-linked-resource-container-id="9404528" data-linked-resource-container-version="10" alt=""></span></li><li>Create an XPath rule to identify your contact type<br/><strong>Business Logic &gt; Rules &gt; YourPackageName &gt; New &gt; Start Rule</strong><br/>This rule we are going to use in the step of workflow in order to identify and process only notifications with our notification contact type selected.<br/><br/><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" draggable="false" src="attachments/9404528/9404532.png" data-image-src="attachments/9404528/9404532.png" data-unresolved-comment-count="0" data-linked-resource-id="9404532" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image2015-4-23 14:37:2.png" data-base-url="https://confluence.origam.com" data-linked-resource-content-type="image/png" data-linked-resource-container-id="9404528" data-linked-resource-container-version="10" alt=""></span></li><li>In <code>GetNotificationContact</code> workflow create a special step for processing our contact type. <br/>Find <code>GetNotificationContact</code>, right click and select <strong>New &gt; Block (Transaction)</strong><br/><br/><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" draggable="false" src="attachments/9404528/9404534.png" data-image-src="attachments/9404528/9404534.png" data-unresolved-comment-count="0" data-linked-resource-id="9404534" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image2015-4-23 14:47:49.png" data-base-url="https://confluence.origam.com" data-linked-resource-content-type="image/png" data-linked-resource-container-id="9404528" data-linked-resource-container-version="10" alt=""></span></li></ol><p>Create a workflow step/s with actual transformation (creation of a new AsapNotificationContact data structure)<br/><code>GetNotificationContacts</code> has the following context stores:</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" draggable="false" src="attachments/9404528/9404537.png" data-image-src="attachments/9404528/9404537.png" data-unresolved-comment-count="0" data-linked-resource-id="9404537" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image2015-4-23 15:32:42.png" data-base-url="https://confluence.origam.com" data-linked-resource-content-type="image/png" data-linked-resource-container-id="9404528" data-linked-resource-container-version="10" alt=""></span></p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">Context Store</th><th colspan="1" class="confluenceTh">Type</th><th class="confluenceTh"> </th></tr><tr><th class="confluenceTh">AsapNotificationContactData</th><td colspan="1" class="confluenceTd">Output</td><td class="confluenceTd"><p>A data structure with a list of found contacts. This context store is a return one and it has to be filled with contacts.</p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" draggable="false" src="attachments/9404528/9404538.png" data-image-src="attachments/9404528/9404538.png" data-unresolved-comment-count="0" data-linked-resource-id="9404538" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image2015-4-23 15:45:48.png" data-base-url="https://confluence.origam.com" data-linked-resource-content-type="image/png" data-linked-resource-container-id="9404528" data-linked-resource-container-version="10" alt=""></span><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" draggable="false" src="attachments/9404528/9404549.png" data-image-src="attachments/9404528/9404549.png" data-unresolved-comment-count="0" data-linked-resource-id="9404549" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image2015-4-24 10:39:58.png" data-base-url="https://confluence.origam.com" data-linked-resource-content-type="image/png" data-linked-resource-container-id="9404528" data-linked-resource-container-version="10" alt=""></span></p></td></tr><tr><th class="confluenceTh">asapNotificationChannelTypeId</th><td colspan="1" class="confluenceTd">Input</td><td class="confluenceTd">Email/Sms etc. (input)</td></tr><tr><th class="confluenceTh">context</th><td colspan="1" class="confluenceTd">Input</td><td class="confluenceTd">Data from a data structure defined in our WorkQueue class as a <strong>NotificationStructure.</strong> If not defined, the context will contain the &quot;raw&quot; data of the <strong>WorkQueueEntry</strong>.</td></tr><tr><th class="confluenceTh">value</th><td colspan="1" class="confluenceTd">Input</td><td class="confluenceTd">A value passed from <strong>Notification Senders/Notification Recipients</strong> tab on the Work Queue screen. It is an additional control value that can be added by a user in the Work Queue notification configuration screen.</td></tr><tr><th class="confluenceTh">workQueueNotificationContactTypeId</th><td colspan="1" class="confluenceTd">Input</td><td class="confluenceTd">A type of notification contact. We already used this value for checking contact type in step 5.</td></tr></tbody></table></div><p>The transformation has to have a target context store set to <code>AsapNotificationContactData</code>. We can create the transformation step by rigth-clicking on <code>AsapNotificationContactData</code> contextstore and choose <strong>Action &gt; New Transform Task</strong>.Then we have to set a <strong>Data</strong> parameter of that transformation to <strong>Context</strong> so we have set the input for the transformation.</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" draggable="false" src="attachments/9404528/9404541.png" data-image-src="attachments/9404528/9404541.png" data-unresolved-comment-count="0" data-linked-resource-id="9404541" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image2015-4-23 15:57:2.png" data-base-url="https://confluence.origam.com" data-linked-resource-content-type="image/png" data-linked-resource-container-id="9404528" data-linked-resource-container-version="10" alt=""></span></p><p>Now move the newly created transformation task under block task with the <code>NotificationContactType</code> condition.</p><p>Finally create a transformation that will produce contact data simillary as in the following example.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Transformation example</b></div><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: xml; gutter: true; theme: Confluence" data-theme="Confluence">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;xsl:stylesheet xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot; version=&quot;1.0&quot;
    xmlns:AS=&quot;http://schema.advantages.cz/AsapFunctions&quot;
    xmlns:date=&quot;http://exslt.org/dates-and-times&quot; exclude-result-prefixes=&quot;AS date&quot;&gt;

    &lt;xsl:template match=&quot;ROOT&quot;&gt;
        &lt;ROOT&gt;
            &lt;xsl:apply-templates select=&quot;RentalTransaction&quot;/&gt;
        &lt;/ROOT&gt;
    &lt;/xsl:template&gt;

    &lt;xsl:template match=&quot;RentalTransaction&quot;&gt;
        &lt;AsapNotificationContact
            ContactIdentification=&quot;{@CustomerEmail}&quot;
            Name=&quot;{@CustomerName}&quot;
            refSalutationId=&quot;{@refCustomerSalutationId}&quot;
        &gt;
            &lt;xsl:if test=&quot;string(@refCustomerLanguageId) != &#39;&#39;&quot;&gt;
                &lt;xsl:attribute name=&quot;LanguageTagIETF&quot;&gt;
                    &lt;xsl:value-of select=&quot;AS:LookupValue(&#39;7823d8af-4968-48c3-a772-287475d429e1&#39;,@refCustomerLanguageId)&quot;/&gt;
                &lt;/xsl:attribute&gt;
            &lt;/xsl:if&gt;
            &lt;xsl:if test=&quot;string(@refCustomerSalutationId) != &#39;&#39;&quot;&gt;
                &lt;xsl:attribute name=&quot;Salutation&quot;&gt;
                    &lt;xsl:value-of select=&quot;AS:LookupValue(&#39;67d3131e-a81d-462d-830c-b67fdb2d6bb8&#39;, @refCustomerSalutationId)&quot;/&gt;
                &lt;/xsl:attribute&gt;
            &lt;/xsl:if&gt;
        &lt;/AsapNotificationContact&gt;
    &lt;/xsl:template&gt;
&lt;/xsl:stylesheet&gt;</pre>
</div></div><h2 id="ExtendingWorkQueueNotificationsWithaNewContactType-AsapNotificationContactentityDescription">AsapNotificationContact entity Description</h2><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">Name</th><th colspan="1" class="confluenceTh">Mandatory</th><th class="confluenceTh">Description</th></tr><tr><th class="confluenceTh">ContactIdentification</th><td colspan="1" style="text-align: center;" class="confluenceTd">x</td><td class="confluenceTd">Identification of a contact. Email in case of e-mail notification channel, phone number in case of SMS channel, etc.</td></tr><tr><th class="confluenceTh">Name</th><td colspan="1" class="confluenceTd"> </td><td class="confluenceTd">Name of contact (e.g. FirstName and Name, or just Name).</td></tr><tr><th class="confluenceTh">LanguageTagIETF</th><td colspan="1" class="confluenceTd"> </td><td class="confluenceTd">Language tag, e.g. 'en-US' or 'de-DE'.</td></tr><tr><th class="confluenceTh">refSalutationId</th><td colspan="1" class="confluenceTd"> </td><td class="confluenceTd">Contact salutation identifier (Guid). Useful in a multilingual application.</td></tr><tr><th class="confluenceTh">Salutation</th><td colspan="1" class="confluenceTd"> </td><td class="confluenceTd">Contact salutation (string).</td></tr></tbody></table></div><h1 id="ExtendingWorkQueueNotificationsWithaNewContactType-Example">Example</h1><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Example of notification template using generated contacts</b></div><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: xml; gutter: false; theme: Confluence" data-theme="Confluence">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;xsl:stylesheet xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot; version=&quot;1.0&quot;
xmlns:AS=&quot;http://schema.advantages.cz/AsapFunctions&quot;
xmlns:date=&quot;http://exslt.org/dates-and-times&quot; exclude-result-prefixes=&quot;AS date&quot;&gt;
&lt;xsl:param name=&quot;RecipientRow&quot; /&gt;

&lt;xsl:template match=&quot;ROOT&quot;&gt;

    &lt;ROOT&gt;
          &lt;AsapNotification&gt;
                 &lt;xsl:attribute name=&quot;Subject&quot;&gt;
                      &lt;xsl:value-of select=&quot;concat(&#39;Rental Transaction &#39;, /ROOT/RentalTransaction/@Number,&#39; Booked&#39;)&quot;/&gt;
                 &lt;/xsl:attribute&gt;
                 &lt;Body&gt;&amp;lt;html&amp;gt;
&lt;xsl:variable name=&quot;salutation&quot;&gt;
  &lt;xsl:choose&gt;
    &lt;xsl:when test=&quot;string($RecipientRow/row/@refSalutationId) = &#39;&#39;&quot;&gt;
      &lt;xsl:value-of select=&quot;&#39;Mr/Ms&#39;&quot; /&gt;
    &lt;/xsl:when&gt;
    &lt;xsl:otherwise&gt;
       &lt;xsl:value-of select=&quot;AS:LookupValue(&#39;67d3131e-a81d-462d-830c-b67fdb2d6bb8&#39;,$RecipientRow/row/@refSalutationId)&quot;/&gt;
    &lt;/xsl:otherwise&gt;
  &lt;/xsl:choose&gt;
...</pre>
</div></div><p> </p><p> </p>
                    </div>

                                                            <div class="pageSection group">
                        <div class="pageSectionHeader">
                            <h2 id="attachments" class="pageSectionTitle">Attachments:</h2>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/9404528/9404527.png">image2015-4-23 12:44:22.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/9404528/9404529.png">image2015-4-23 14:26:42.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/9404528/9404531.png">image2015-4-23 14:28:44.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/9404528/9404532.png">image2015-4-23 14:37:2.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/9404528/9404533.png">image2015-4-23 14:42:22.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/9404528/9404534.png">image2015-4-23 14:47:49.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/9404528/9404537.png">image2015-4-23 15:32:42.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/9404528/9404538.png">image2015-4-23 15:45:48.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/9404528/9404539.png">image2015-4-23 15:47:15.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/9404528/9404540.png">image2015-4-23 15:56:50.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/9404528/9404541.png">image2015-4-23 15:57:2.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/9404528/9404545.png">image2015-4-23 17:11:37.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/9404528/9404549.png">image2015-4-24 10:39:58.png</a> (image/png)
                                <br/>
                                                    </div>
                    </div>
                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Jun 29, 2022 20:33</p>
                    <div id="footer-logo"><a href="https://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
