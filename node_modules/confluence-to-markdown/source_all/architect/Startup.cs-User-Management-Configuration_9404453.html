<!DOCTYPE html>
<html>
    <head>
        <title>ORIGAM Documentation : Startup.cs User Management Configuration</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">ORIGAM Documentation</a></span>
                            </li>
                                                    <li>
                                <span><a href="ORIGAM-Enterprise-Home_589829.html">ORIGAM Enterprise Home</a></span>
                            </li>
                                                    <li>
                                <span><a href="ORIGAM-Runtime_8716600.html">ORIGAM Runtime</a></span>
                            </li>
                                                    <li>
                                <span><a href="Installation-and-Configuration_1277994.html">Installation and Configuration</a></span>
                            </li>
                                                    <li>
                                <span><a href="Configuration_7831576.html">Configuration</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            ORIGAM Documentation : Startup.cs User Management Configuration
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
    
        
    
        
        
            Created by <span class='author'> Petr Hrehorovský</span>, last modified on Jun 21, 2017
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <p>This article provides information on configuration of user management in Origam application.</p><p> <style type='text/css'>/*<![CDATA[*/
div.rbtoc1656534815289 {padding: 0px;}
div.rbtoc1656534815289 ul {list-style: none !important;margin-left: 0px;}
div.rbtoc1656534815289 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class='toc-macro rbtoc1656534815289'>
<ul class='toc-indentation'>
<li><a href='#Startup.csUserManagementConfiguration-WindowsAuthentication'>Windows Authentication</a></li>
<li><a href='#Startup.csUserManagementConfiguration-OrigammodelforUSERauthentication'>Origam model for USER authentication</a></li>
<li><a href='#Startup.csUserManagementConfiguration-Two-FactorAuthentication'>Two-Factor Authentication</a></li>
<li><a href='#Startup.csUserManagementConfiguration-E-mailAddressConfirmationFeature'>E-mail Address Confirmation Feature</a></li>
<li><a href='#Startup.csUserManagementConfiguration-ComplexConfigurationExample'>Complex Configuration Example</a></li>
</ul>
</div></p><p> </p><p>Sample <code>Startup.cs</code> is included in build in file <code>Startup.cs_</code>. As default <code>Startup.cs_</code> is configured to use AspNet Membership provider to preserve backwards compatibility.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Registration of callback function</b></div><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: c#; gutter: false; theme: Confluence" data-theme="Confluence">AbstractUserManager.RegisterCreateUserManagerCallback(CreateUserManager);</pre>
</div></div><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>CreateUserManager Function</b></div><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: cpp; gutter: false; theme: Confluence" data-theme="Confluence">private static AbstractUserManager CreateUserManager()
{
	return NetMembershipUserManager.Create();
}</pre>
</div></div><h2 id="Startup.csUserManagementConfiguration-WindowsAuthentication">Windows Authentication</h2><p>When you use pure Windows Authentication in IIS (no login screen, just single-sign-on using your Windows credentials) you need to comment out the following section from <strong>Startup.cs:</strong></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: c#; gutter: false; theme: Confluence" data-theme="Confluence">/*
app.UseCookieAuthentication(new CookieAuthenticationOptions
{
    AuthenticationType = DefaultAuthenticationTypes.ApplicationCookie,
    LoginPath = new PathString(&quot;/Login&quot;),
    ExpireTimeSpan = System.TimeSpan.FromMinutes(10)
});
*/</pre>
</div></div><h2 id="Startup.csUserManagementConfiguration-OrigammodelforUSERauthentication">Origam model for USER authentication</h2><p>If you decide to use Origam model for user authentication, you need to switch to <code>OrigamModelUserManager</code> class.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Using OrigamModelUserManager</b></div><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: c#; gutter: false; theme: Confluence" data-theme="Confluence">private static AbstractUserManager CreateUserManager()
{
	return OrigamModelUserManager.Create();
}</pre>
</div></div><p>By default <code>OrigamModelUserManager</code> class is using following settings:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">Setting</th><th class="confluenceTh">Value</th></tr><tr><td class="confluenceTd">Minimum password length</td><td style="text-align: right;" class="confluenceTd">12</td></tr><tr><td class="confluenceTd">Number of required non-alphanumeric characters in password</td><td style="text-align: right;" class="confluenceTd">6</td></tr><tr><td class="confluenceTd">Number of invalid password attempts</td><td style="text-align: right;" class="confluenceTd">3</td></tr></tbody></table></div><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Basic OrigamModelUserManager Configuration</b></div><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: c#; gutter: false; theme: Confluence" data-theme="Confluence">private static AbstractUserManager CreateUserManager()
{
    OrigamModelUserManager manager = (OrigamModelUserManager)OrigamModelUserManager.Create();
    manager.MinimumPasswordLength = 4;
    manager.NumberOfRequiredNonAlphanumericCharsInPassword = 0;
    manager.NumberOfInvalidPasswordAttempts = 3;
    return manager;
}</pre>
</div></div><h2 id="Startup.csUserManagementConfiguration-Two-FactorAuthentication">Two-Factor Authentication</h2><p>Origam system is capable of two-factor authentication. Right now only email is implemented as the second factor. If two-factor authentication is enabled, the user is redirected after providing username/password to the <code>~/Login2</code> URL, where she should provide security code.</p><div class="confluence-information-macro confluence-information-macro-information"><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p><code>~/Login2</code> URL should be accessible for unauthorized access. You need to amend <code>web.config</code> in appropriate way.</p></div></div><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Two-Factor Authentication: Email</b></div><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: c#; gutter: false; theme: Confluence" data-theme="Confluence">private static AbstractUserManager CreateUserManager()
{
    AbstractUserManager manager = OrigamModelUserManager.Create();
    manager.RegisterTwoFactorProvider(
        &quot;EmailCode&quot;, new EmailTokenProvider&lt;OrigamUser&gt;()
        {
             Subject = &quot;Security Code&quot;,
             BodyFormat = &quot;Your security code is {0}.&quot;
        });
    manager.EmailService = new IdentityEmailService(&quot;admin@origam.com&quot;);
    manager.Is2FAUsed = true;
    return manager;
}</pre>
</div></div><h2 id="Startup.csUserManagementConfiguration-E-mailAddressConfirmationFeature">E-mail Address Confirmation Feature</h2><p>As a new feature Origam provides possibility to confirm e-mail address. This feature is implemented via model of the application, but to be able to use it, user manager needs to have a token provider set up. Feature also provides special URL <code>~/ConfirmEmail</code> (see: <a href="Email-Address-Confirmation_9404451.html">Email Address Confirmation</a>). </p><div class="confluence-information-macro confluence-information-macro-information"><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p><code>~/ConfirmEmail</code> URL should be accessible for unauthorized access. You need to amend <code>web.config</code> in appropriate way.</p></div></div><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Token Provider Configuration</b></div><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: c#; gutter: false; theme: Confluence" data-theme="Confluence">private static AbstractUserManager CreateUserManager()
{
    AbstractUserManager manager = OrigamModelUserManager.Create();
    DpapiDataProtectionProvider protectionProvider 
        = new DpapiDataProtectionProvider(&quot;Origam&quot;);
    manager.UserTokenProvider = new OrigamTokenProvider(
        protectionProvider.Create(&quot;Confirmation&quot;));
    return manager;
}</pre>
</div></div><h2 id="Startup.csUserManagementConfiguration-ComplexConfigurationExample">Complex Configuration Example</h2><p>This example of application configured for e-mail address confirmation, two-factor authentication and with customized password settings.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Complex Configuration Example</b></div><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: c#; gutter: false; theme: Confluence" data-theme="Confluence">private static AbstractUserManager CreateUserManager()
{
    OrigamModelUserManager manager = (OrigamModelUserManager)OrigamModelUserManager.Create();
	// password settings
    manager.MinimumPasswordLength = 7;
    manager.NumberOfRequiredNonAlphanumericCharsInPassword = 1;
    manager.NumberOfInvalidPasswordAttempts = 5;
	// two-factor configuration
    manager.RegisterTwoFactorProvider(
        &quot;EmailCode&quot;, new EmailTokenProvider&lt;OrigamUser&gt;()
        {
             Subject = &quot;Security Code&quot;,
             BodyFormat = &quot;Your security code is {0}.&quot;
        });
    manager.EmailService = new IdentityEmailService(&quot;admin@origam.com&quot;);
	// e-mail address confirmation
	DpapiDataProtectionProvider protectionProvider 
        = new DpapiDataProtectionProvider(&quot;Origam&quot;);
    manager.UserTokenProvider = new OrigamTokenProvider(
        protectionProvider.Create(&quot;Confirmation&quot;));
    return manager;
}</pre>
</div></div>
                    </div>

                                        
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Jun 29, 2022 20:33</p>
                    <div id="footer-logo"><a href="https://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
